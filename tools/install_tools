#!/bin/bash
#
# Responsible to install the FIAP environment tool
#

echo '# File generated during the system provosioner
deb http://httpredir.debian.org/debian jessie main contrib non-free
deb-src http://httpredir.debian.org/debian jessie main contrib non-free

deb http://security.debian.org/ jessie/updates main contrib non-free
deb-src http://security.debian.org/ jessie/updates main contrib non-free
' > /etc/apt/sources.list

echo "Installing general tools"
apt-get install -y \
	vim  \
	wget \
	nano \
	curl \
	sudo \
	bash-completion \
	apt-transport-https \
	git \
	software-properties-common \
	build-essential 

echo 'Setting up VIM'
echo '" Generated by the vagrant provisioner
set number
set expandtab
set bg=dark
set sw=4
set ts=4
set backspace=2
set autoindent
syntax on
' >> /etc/vim/vimrc

echo "[hosts.file] Creating the dns configuration"
echo "
# This was generated during the vagrant provisioner
192.168.200.50	devops.dexter.com.br devops
192.168.200.100 docker.dexter.com.br docker
" >> /etc/hosts

echo "Add external dns servers"
echo "
# This line was generated during the vagrant provisioner
nameserver 8.8.8.8
nameserver 8.8.4.4
" >> /etc/resolv.conf 

echo "Change root password to fiap/fiap"
echo "root:fiap" | chpasswd 


echo "Creating the fiap user with password fiap"
if ! useradd -m fiap -s '/bin/bash'; then
	echo "Could not create the user fiap"
	echo "Try to log in with the user/password vagrant/vagrant"
else
	echo "fiap:fiap" | chpasswd
fi

echo "Configuring sudoers file"
echo "
# This file was genrated during the vagrant provisioner
fiap ALL=(ALL:ALL) NOPASSWD: ALL
" >> /etc/sudoers.d/fiap

echo "Installing the makeclass tools"
if ! cp /vagrant/tools/makeclass /bin/makeclass; then
	echo "Could not install the makeclass tool for class automation"
	exit 1
fi

if [[ -d '/vagrant/devops/files' ]]; then
	mkdir -p /root/puppet/dns

	cp -r /vagrant/devops/files /root/puppet/dns
fi
